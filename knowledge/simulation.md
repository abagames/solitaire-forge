# シミュレーション実行と評価フィードバック作成 インストラクション

## 1. 目的

この文書は、LLM（大規模言語モデル）によって生成された一人用トランプゲームの定義を評価し、その結果を LLM へのフィードバックとして構造化するためのガイドラインを提供します。

一貫性のある評価基準と明確なフィードバックフォーマットを用いることで、LLM との協調的なゲームデザインプロセスを効率化し、ゲームルールの改善精度を高めることを目的とします。

## 2. シミュレーション実行ガイド

### 2.1. 実行方法

各ゲームには専用のシミュレーターファイルが存在します (例: `src/games/[ゲーム名]/simulator.ts`)。このファイルを Node.js で直接実行します。実行には `ts-node` が必要です。

```bash
# 例: cartographers-expedition ゲームの場合
node --loader ts-node/esm src/games/cartographers-expedition/simulator.ts
```

**新しいゲームのシミュレーター設定:**

1.  `src/simulator_template.ts` をコピーし、新しいゲームのディレクトリ (例: `src/games/[新しいゲーム名]/`) に `simulator.ts` として配置します。
2.  コピーした `simulator.ts` ファイルを開き、ファイル冒頭の指示コメントに従って以下の点を編集します:
    - ゲーム定義ファイル (`definition.ts` または `index.ts`) と AI ファイル (`ai.ts`) をインポートするように `import` 文のコメントを解除し、パスを修正します。
    - `main` 関数内で `runSimulations` を呼び出している箇所で、プレースホルダー (`YourGameDefinition`, `YourGameBasicAI`) をインポートしたものに置き換えます。
    - シード名のプレフィックス (`simulationSeedPrefix`) をゲーム名に合わせて変更します。
    - 必要に応じて `printSummary` の AI 名表示を調整します。

**既存のゲームのシミュレーション実行:**

対象ゲームの `simulator.ts` ファイル (例: `src/games/[ゲーム名]/simulator.ts`) を開き、ゲーム定義と AI が正しくインポートされ、`main` 関数内で参照されていることを確認してから、上記の `node` コマンドを実行してください。

このスクリプトは、ファイル内で定義された `NUM_TRIALS` 回数だけ、`RandomAI` と `ゲーム固有のBasicAI` の**両方**でゲームをシミュレーションし、それぞれの結果を集計してコンソールに出力します。

### 2.2. プレイヤー AI

シミュレーター (`src/simulator.ts`) は通常、以下の 2 種類の AI で評価を行います。

- **ランダム AI (`RandomAI`):**
  - **動作:** 常に有効な手の中からランダムに 1 つを選択します。
  - **目的:** ルール上の基本的な実行可能性や、運のみでの達成度 (ベースライン) を測ります。ゲームの最低限の難易度や、手詰まりの発生しやすさの指標となります。
- \*\*基本戦略 AI (`ゲーム固有のBasicAI`, 例: `CartographersBasicAI`):
  - **動作:** ゲームごとに定義された、比較的シンプルな戦略ロジックに基づいて行動を選択します。(例: 目標に最も近い手を選ぶ、特定のカードを優先するなど)。通常、「記憶」のような複雑な状態保持は行いません。
  - **目的:** ゲームの基本的な戦略（デザイナーが意図するであろう単純なプレイスタイル）の有効性や、ゲームメカニクスが戦略的判断にどの程度寄与するかを評価します。

**比較の重要性:** `RandomAI` と `BasicAI` の結果を比較することで、導入された戦略的要素がランダムプレイに対してどの程度の優位性をもたらすか、ゲームにスキルが介在する余地がどの程度あるかを判断する重要な手がかりとなります。

### 2.3. 試行回数

- **デフォルト回数:** 各ゲームの `simulator.ts` 内の `NUM_TRIALS` 定数で定義されており、デフォルトは **1000 回**です。必要に応じてこの値を変更して実行してください。より多くの回数を実行することで、統計的な信頼性が向上します。

### 2.4. 再現性

- **決定論的シード:** 各ゲームの `simulator.ts` 内の `simulationSeedRandom` および `simulationSeedBasic` 定数で、各 AI のシミュレーション試行群の基盤となるシードが定義されています (例: `[ゲーム名]-rand-v1`)。各試行 (`trial`) および各試行内の各 AI の手番 (`turn`) では、この基盤シードとインデックス (例: `baseSeed-trial-i`, `baseSeed-trial-i-turn-j`) から派生した一意のシードが内部的に使用されます。これにより、特定のシード値を使えば、シミュレーション全体（ゲームのセットアップと AI の全ての行動選択）を完全に再現できます。

## 3. 収集される定量的データ

シミュレーションスクリプト (`src/games/[ゲーム名]/simulator.ts`) は、以下のデータを自動的に集計し、コンソールに出力します (`SimulationSummary` 型)。

- **総ゲーム数 (`totalGames`)**
- **勝利数 (`wins`)**
- **敗北数 (`losses`)**
- **勝率 (`winRate`)**: %
- **敗北原因別統計 (`lossRateByReason`)**:
  - 原因文字列 (例: `STUCK`, `MAX_MOVES_REACHED`) ごとに、
    - 発生回数 (`count`)
    - 全ゲームに対する割合 (`rate`, %)
- **手数統計 (`movesOverall`, `movesWins`, `movesLosses`)**:
  - 全ゲーム、勝利ゲーム、敗北ゲームそれぞれについて、
    - 平均手数 (`average`)
    - 最小手数 (`min`)
    - 最大手数 (`max`)

## 4. 評価すべき定性的観点

収集された定量的データ、および可能であれば人間による数回の試遊を通して、以下の観点を評価してください。

- **コアメカニクスの機能性:**
  - ゲームの中心として意図されたメカニクスは、実際に機能していますか？ (例: AI アクション使用頻度で特定のメカニクス関連アクションが少ない場合、機能していない可能性)
  - プレイヤーはそのメカニクスを理解し、活用できますか？
  - そのメカニクスはプレイしていて面白いですか、あるいは単調ですか？
- **ゲームの進行とテンポ:**
  - ゲームはスムーズに進行しますか？ 停滞しやすい局面はありますか？ (例: 敗北原因で `STUCK` が多い場合、手詰まりしやすい)
  - 序盤・中盤・終盤でゲームの様相は変化しますか？
  - 1 プレイの時間は適切ですか？ (平均手数/ターン数で判断)
- **戦略の多様性:**
  - 勝利に至るための有効な戦略やアプローチは複数存在しそうですか？
  - 特定のカードやアクションが圧倒的に強く、他の選択肢が無意味になっていませんか？ (AI アクション使用頻度で偏りがないか)
- **プレイヤーの選択肢:**
  - ゲーム中、プレイヤーは常に複数の意味のあるアクションを選択できますか？
  - 選択に悩む場面はありますか？ それとも、取るべき行動が自明な場合が多いですか？
- **難易度と達成感:**
  - 難易度は適切ですか？
  - 勝利した時に達成感はありますか？ 敗北した時に納得感はありますか？
  - BasicAI の勝率が極端に高い (特に 100% に近い) 場合、それは単に AI が優秀であるだけでなく、ゲームが簡単すぎるか、あるいは単調な必勝パターンが存在する可能性を示す重要な兆候です。勝率だけでなく、その勝ち方にも注意を払う必要があります。
- **運と実力のバランス:**
  - ゲームの結果は、主に運によって決まりますか、それともプレイヤーの判断によって左右されますか？
  - 許容できないレベルの運要素（例: 初手で詰む可能性が高い）はありませんか？
- **テーマとの整合性:** (該当する場合)
  - ゲームプレイ（ルール、アクション、目標）は、設定されたテーマ/コンセプトをうまく表現できていますか？
- **面白さ / フラストレーション:**
  - プレイしていて最も面白いと感じる瞬間/要素は何ですか？
  - 最もつまらない、あるいはストレスを感じる瞬間/要素は何ですか？ (敗北原因やスコアの低さなどから推測)
- **ルール上の問題:**
  - シミュレーション中に、無限ループ、状態の矛盾、予期せぬ動作、ルール解釈の曖昧さなどはありませんでしたか？
  - 悪用可能（Exploitable）なルールの組み合わせはありませんか？
  - エッジケース（特殊な状況）でルールが破綻しませんか？
